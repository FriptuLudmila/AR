<!-- import aframe and then ar.js with image tracking / location based features -->
<script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

<script>
  // Sequential scanning state management
  let firstMarkerScanned = false;
  let secondMarkerUnlocked = false;

  window.addEventListener('load', function() {
    const sceneEl = document.querySelector('a-scene');
    const firstNft = document.querySelector('#first-marker');
    const secondNft = document.querySelector('#second-marker');
    const statusText = document.querySelector('#status-text');

    // Initially hide the second marker
    secondNft.setAttribute('visible', 'false');

    // First marker (milky) events
    firstNft.addEventListener('markerFound', function() {
      console.log('First marker (milky) found!');

      if (!firstMarkerScanned) {
        firstMarkerScanned = true;
        secondMarkerUnlocked = true;

        // Show second marker is now unlocked
        alert('First object scanned! You can now scan the booksign.');
        statusText.setAttribute('text', 'value', 'First scanned! Now find booksign.');

        // Enable the second marker
        secondNft.setAttribute('visible', 'true');
      }
    });

    firstNft.addEventListener('markerLost', function() {
      console.log('First marker lost');
    });

    // Second marker (booksign) events
    secondNft.addEventListener('markerFound', function() {
      console.log('Second marker (booksign) found!');

      if (secondMarkerUnlocked) {
        alert('Second object scanned! Griffin should be visible now!');
        statusText.setAttribute('text', 'value', 'Both objects scanned!');

        // Debug: Check if griffin model exists and is loaded
        const griffinModel = document.querySelector('#griffin-model');
        console.log('Griffin model element:', griffinModel);
        console.log('Griffin visible:', griffinModel.getAttribute('visible'));
        console.log('Griffin position:', griffinModel.getAttribute('position'));
        console.log('Griffin scale:', griffinModel.getAttribute('scale'));
      } else {
        console.log('Second marker detected but not unlocked yet');
        alert('Please scan the first marker (milky) first!');
      }
    });

    secondNft.addEventListener('markerLost', function() {
      console.log('Second marker lost');
    });

    // Initial status message
    statusText.setAttribute('text', 'value', 'Scan the first object (milky)');
  });
</script>

<!-- style for the loader -->
<style>
  .arjs-loader {
    height: 100%;
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .arjs-loader div {
    text-align: center;
    font-size: 1.25em;
    color: white;
  }
</style>

<body style="margin : 0px; overflow: hidden;">
  <!-- minimal loader shown until image descriptors are loaded. Loading may take a while according to the device computational power -->
  <div class="arjs-loader">
    <div>Loading, please wait...</div>
  </div>

  <!-- a-frame scene -->
  <a-scene
    vr-mode-ui="enabled: false;"
    renderer="logarithmicDepthBuffer: true;"
    embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; sourceWidth: 640; sourceHeight: 480; displayWidth: 640; displayHeight: 480;"
  >
    <!-- FIRST NFT MARKER: milky -->
    <a-nft
      id="first-marker"
      type="nft"
      url="./milky"
      smooth="true"
      smoothCount="20"
      smoothTolerance="0.5"
      smoothThreshold="2"
    >
      <!-- First object 3D model -->
      <a-entity
        gltf-model="scene.gltf"
        scale="100 100 100"
        position="0 0 0"
        rotation="0 0 0"
      >
      </a-entity>
    </a-nft>

    <!-- SECOND NFT MARKER: booksign (initially hidden) -->
    <a-nft
      id="second-marker"
      type="nft"
      url="./booksign"
      smooth="true"
      smoothCount="20"
      smoothTolerance="0.5"
      smoothThreshold="2"
      visible="false"
    >
      <!-- Second object 3D model - Griffin -->
      <a-entity
        id="griffin-model"
        gltf-model="griffin.gltf"
        scale="50 50 50"
        position="0 0 0"
        rotation="0 0 0"
      >
      </a-entity>
      <!-- Debug red box to verify marker tracking -->
      <a-box
        color="red"
        width="50"
        height="50"
        depth="50"
        position="0 25 0"
        opacity="0.5"
      ></a-box>
    </a-nft>

    <!-- Status text displayed on screen -->
    <a-text
      id="status-text"
      value="Initializing..."
      color="yellow"
      position="0 2 -3"
      align="center"
      width="6"
    ></a-text>
    <!-- static camera that moves according to the device movemenents -->
    <a-entity camera></a-entity>
  </a-scene>
</body>